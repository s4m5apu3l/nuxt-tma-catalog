import{u as I,I as J,Q as u}from"./D8xujKC5.js";import{u as $}from"./CaA2w-bX.js";import{U as x,M as f,r as v}from"./iOMO9ifF.js";const a=v([]),o=v(!1),n=v(null),p=v(0),B=300*1e3,g=t=>({...t,name:typeof t.name=="string"?JSON.parse(t.name):t.name,description:typeof t.description=="string"?JSON.parse(t.description):t.description}),R=()=>{const{databases:t}=I(),{handleError:l}=$(),m=x(),i=m.public.appwriteBdKey,c=m.public.appwriteCollectionCategories,h=()=>Date.now()-p.value<B&&a.value.length>0,A=async(r=!1)=>{if(!(!r&&h())){o.value=!0,n.value=null;try{const e=await t.listDocuments(i,c,[u.equal("isActive",!0),u.orderAsc("sortOrder"),u.orderDesc("$createdAt")]);a.value=e.documents.map(g),p.value=Date.now()}catch(e){console.error("Error fetching categories:",e),n.value="Failed to fetch categories",l(e,"Ошибка загрузки категорий")}finally{o.value=!1}}},D=async r=>{o.value=!0,n.value=null;try{const e=await t.createDocument(i,c,J.unique(),{...r,name:JSON.stringify(r.name),description:JSON.stringify(r.description),sortOrder:r.sortOrder??0,isActive:r.isActive??!0}),s=g(e);return a.value.push(s),a.value.sort((y,d)=>y.sortOrder-d.sortOrder),s}catch(e){return console.error("Error creating category:",e),n.value="Failed to create category",l(e,"Ошибка создания категории"),null}finally{o.value=!1}},O=async r=>{o.value=!0,n.value=null;try{const{$id:e,...s}=r,y=await t.updateDocument(i,c,e,{...s,name:JSON.stringify(s.name),description:JSON.stringify(s.description)}),d=g(y),C=a.value.findIndex(F=>F.$id===e);return C!==-1&&(a.value[C]=d),d}catch(e){return console.error("Error updating category:",e),n.value="Failed to update category",l(e,"Ошибка обновления категории"),null}finally{o.value=!1}},w=async r=>{o.value=!0,n.value=null;try{return await t.deleteDocument(i,c,r),a.value=a.value.filter(e=>e.$id!==r),!0}catch(e){return console.error("Error deleting category:",e),n.value="Failed to delete category",l(e,"Ошибка удаления категории"),!1}finally{o.value=!1}},E=r=>a.value.find(e=>e.slug===r),b=r=>a.value.find(e=>e.$id===r),N=async()=>{o.value=!0,n.value=null;try{const r=await t.listDocuments(i,c,[u.orderAsc("sortOrder"),u.orderDesc("$createdAt")]);a.value=r.documents.map(g),p.value=Date.now()}catch(r){console.error("Error fetching all categories:",r),n.value="Failed to fetch all categories",l(r,"Ошибка загрузки всех категорий")}finally{o.value=!1}},S=()=>a.value.filter(r=>r.isActive);return{categories:f(a),loading:f(o),error:f(n),fetchCategories:A,fetchAllCategories:N,createCategory:D,updateCategory:O,deleteCategory:w,getCategoryBySlug:E,getCategoryById:b,getActiveCategories:S}};export{R as u};
