import{_ as X}from"./B6OSm-Dn.js";import{_ as Z}from"./CoxgazRA.js";import{o as T,n as ee,s as B,_ as ae,a as oe,b as te,c as j}from"./CJVbPopT.js";import{_ as re}from"./CXMMb_go.js";import{r as A,M as S,S as le,e as z,f as Y,g as se,c as E,o as I,a as c,k as M,t as b,h as e,F as J,n as Q,b as r,w as n,d as O,m as G,p as L,j as ne,T as de,I as ie,l as ce,i as W,E as ue}from"./CGidw6B-.js";import{_ as me}from"./BK1w3cMd.js";import{v as pe,g as ge}from"./EIiInBYa.js";import{u as fe,I as be}from"./BkcUQ56Y.js";import{u as ve}from"./CTynOHMU.js";const he={maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"},_e=async(p,U={})=>{const t={...he,...U};return new Promise((h,a)=>{const x=new FileReader;x.onload=k=>{const y=new Image;y.onload=()=>{try{const o=document.createElement("canvas");let{width:f,height:s}=y;if(f>t.maxWidth||s>t.maxHeight){const m=Math.min(t.maxWidth/f,t.maxHeight/s);f=Math.round(f*m),s=Math.round(s*m)}o.width=f,o.height=s;const i=o.getContext("2d");if(!i){a(new Error("Failed to get canvas context"));return}i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(y,0,0,f,s),o.toBlob(m=>{if(!m){a(new Error("Failed to compress image"));return}const _=new File([m],p.name,{type:t.mimeType,lastModified:Date.now()});h(_)},t.mimeType,t.quality)}catch(o){a(o)}},y.onerror=()=>{a(new Error("Failed to load image"))},y.src=k.target?.result},x.onerror=()=>{a(new Error("Failed to read file"))},x.readAsDataURL(p)})};const ye=()=>{const{storage:p}=fe(),U=le(),t=A(!1),h=A(0),a=A(null),x=A(!0),k=async(s,i=!0)=>{const m=pe(s);if(!m.isValid)throw new Error(m.error);t.value=!0,a.value=null,h.value=0;try{let _=s;i&&x.value&&(h.value=10,_=await _e(s,{maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"}),h.value=30);const F=be.unique(),C=U.public.appwriteBucketId;if(!C)throw new Error("Storage bucket ID is not configured");const R=await p.createFile(C,F,_);return h.value=100,R.$id}catch(_){const F=_ instanceof Error?_.message:"Failed to upload image";throw a.value=F,new Error(F)}finally{t.value=!1}},y=async(s,i=!0)=>{const m=s.map(_=>k(_,i));return Promise.all(m)},o=async s=>{try{const i=U.public.appwriteBucketId;if(!i)throw new Error("Storage bucket ID is not configured");await p.deleteFile(i,s)}catch(i){const m=i instanceof Error?i.message:"Failed to delete image";throw a.value=m,new Error(m)}},f=async s=>{try{const i=U.public.appwriteBucketId;if(!i)throw new Error("Storage bucket ID is not configured");return await p.getFile(i,s)}catch(i){const m=i instanceof Error?i.message:"Failed to get image info";throw a.value=m,new Error(m)}};return{isUploading:S(t),uploadProgress:S(h),error:S(a),compressionEnabled:x,uploadImage:k,uploadImages:y,deleteImage:o,getImageInfo:f}},xe={class:"space-y-4"},we={class:"flex items-center justify-between"},Ve={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Ie={class:"text-xs text-gray-500"},Ue={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ke=["src","alt"],$e={class:"absolute inset-0 flex items-center justify-center"},Fe=["disabled"],Ee={class:"space-y-2"},Ae={class:"text-sm text-gray-600 dark:text-gray-400"},Ce={class:"font-medium"},Pe={class:"text-xs mt-1"},De={key:2,class:"text-sm text-red-600 dark:text-red-400"},Be=z({__name:"ImageUpload",props:{modelValue:{},maxImages:{default:5},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(p,{emit:U}){const t=p,h=U,{uploadImage:a,deleteImage:x,isUploading:k,error:y}=ye(),{t:o}=Y(),f=A(),s=A(!1),i=se(()=>t.modelValue.length<t.maxImages),m=async g=>{if(!g||g.length===0)return;const u=t.maxImages-t.modelValue.length,w=Array.from(g).slice(0,u);try{for(const V of w){const $=await a(V);h("update:modelValue",[...t.modelValue,$])}}catch(V){console.error("Failed to upload images:",V)}},_=g=>{const u=g.target;m(u.files),u&&(u.value="")},F=g=>{g.preventDefault(),s.value=!1,!t.disabled&&m(g.dataTransfer?.files||null)},C=g=>{g.preventDefault(),s.value=!0},R=()=>{s.value=!1},v=async g=>{const u=t.modelValue[g];if(u)try{await x(u);const w=[...t.modelValue];w.splice(g,1),h("update:modelValue",w)}catch(w){console.error("Failed to delete image:",w)}},d=()=>{t.disabled||!i.value||f.value?.click()};return(g,u)=>{const w=G,V=ne;return I(),E("div",xe,[c("div",we,[c("label",Ve,b(e(o)("admin.images")),1),c("span",Ie,b(p.modelValue.length)+" / "+b(p.maxImages),1)]),p.modelValue.length>0?(I(),E("div",Ue,[(I(!0),E(J,null,Q(p.modelValue,($,P)=>(I(),E("div",{key:$,class:"relative group aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden"},[c("img",{src:e(ge)($),alt:`Image ${P+1}`,class:"w-full h-full object-cover"},null,8,ke),c("div",$e,[r(w,{color:"error",variant:"solid",size:"sm",icon:"i-lucide-trash-2",disabled:p.disabled,onClick:H=>v(P)},{default:n(()=>[O(b(e(o)("common.delete")),1)]),_:1},8,["disabled","onClick"])])]))),128))])):M("",!0),e(i)?(I(),E("div",{key:1,class:L(["border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center cursor-pointer transition-colors duration-200",{"border-primary-500 bg-primary-50 dark:bg-primary-900/20":e(s),"hover:border-gray-400 dark:hover:border-gray-500":!p.disabled&&!e(s),"opacity-50 cursor-not-allowed":p.disabled}]),onClick:d,onDrop:F,onDragover:C,onDragleave:R},[c("input",{ref_key:"fileInput",ref:f,type:"file",multiple:"",accept:"image/jpeg,image/png,image/webp",class:"hidden",disabled:p.disabled,onChange:_},null,40,Fe),c("div",Ee,[r(V,{name:"i-lucide-upload",class:L(["mx-auto text-4xl text-gray-400",{"animate-pulse":e(k)}])},null,8,["class"]),c("div",Ae,[c("p",Ce,b(e(k)?e(o)("admin.uploading"):e(o)("admin.clickToUpload")),1),c("p",null,b(e(o)("admin.dragAndDrop")),1),c("p",Pe,b(e(o)("admin.imageFormats"))+" ("+b(e(o)("admin.maxSize"))+": 5MB)",1)])])],34)):M("",!0),e(y)?(I(),E("div",De,b(e(y)),1)):M("",!0)])}}}),Re=Object.assign(Be,{__name:"ImageUpload"}),qe={class:"text-base font-semibold"},Me={class:"space-y-4"},Oe={class:"flex items-center justify-between"},Te={class:"text-base font-semibold"},Se={class:"space-y-4"},He={class:"space-y-3"},Ne={class:"text-base font-semibold"},je={class:"text-base font-semibold"},Le={class:"space-y-4"},We={class:"text-xs text-muted-foreground"},ze={class:"space-y-3"},Ye={class:"text-xs text-muted-foreground"},Je={class:"flex items-center space-x-2"},Qe=z({__name:"ProductForm",props:{product:{},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(p,{emit:U}){const t=p,h=U,{t:a}=Y(),{categories:x,fetchCategories:k}=ve(),y=T({name:T({en:B().min(1,a("admin.products.errors.nameEnRequired")),ru:B().min(1,a("admin.products.errors.nameRuRequired"))}),description:T({en:B().min(1,a("admin.products.errors.descriptionEnRequired")),ru:B().min(1,a("admin.products.errors.descriptionRuRequired"))}),categoryId:B().min(1,a("admin.products.errors.categoryRequired")),slug:B().min(1,a("admin.products.errors.slugRequired")),sortOrder:ee().min(0),isActive:j(),isAvailable:j()}),o=de({name:{en:t.product?.name.en||"",ru:t.product?.name.ru||""},description:{en:t.product?.description.en||"",ru:t.product?.description.ru||""},categoryId:t.product?.categoryId||"",slug:t.product?.slug||"",sortOrder:t.product?.sortOrder||0,isActive:t.product?.isActive??!0,isAvailable:t.product?.isAvailable??!0}),f=A(t.product?.pricing&&t.product.pricing.length>0?t.product.pricing.map(v=>({...v})):[{period:"day",price:0,currency:"₽"}]),s=A(t.product?.images?[...t.product.images]:[]),i=[{value:"hour",label:a("admin.products.priceUnits.hour")},{value:"day",label:a("admin.products.priceUnits.day")},{value:"week",label:a("admin.products.priceUnits.week")},{value:"month",label:a("admin.products.priceUnits.month")}],m=[{value:"₽",label:"₽ (RUB)"},{value:"$",label:"$ (USD)"},{value:"€",label:"€ (EUR)"},{value:"฿",label:"฿ (THB)"},{value:"¥",label:"¥ (CNY/JPY)"}],_=()=>{f.value.push({period:"day",price:0,currency:"₽"})},F=v=>{f.value.length>1&&f.value.splice(v,1)},C=v=>v.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();ie(()=>o.name.en,v=>{!t.product&&v&&(o.slug=C(v))}),ce(async()=>{x.value.length||await k()});const R=async()=>{const v={name:o.name,description:o.description,categoryId:o.categoryId,pricing:f.value.filter(d=>d.price>0),images:s.value,slug:o.slug,sortOrder:o.sortOrder,isActive:o.isActive,isAvailable:o.isAvailable};h("submit",v)};return(v,d)=>{const g=X,u=Z,w=oe,V=re,$=G,P=me,H=Re,N=te,K=ae;return I(),W(K,{schema:e(y),state:e(o),class:"space-y-4",onSubmit:R},{default:n(()=>[r(V,null,{header:n(()=>[c("h3",qe,b(e(a)("admin.products.form.basicInfo")),1)]),default:n(()=>[c("div",Me,[r(u,{label:e(a)("admin.products.form.nameEn"),name:"name.en",required:""},{default:n(()=>[r(g,{modelValue:e(o).name.en,"onUpdate:modelValue":d[0]||(d[0]=l=>e(o).name.en=l),placeholder:e(a)("admin.products.form.nameEnPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(u,{label:e(a)("admin.products.form.nameRu"),name:"name.ru",required:""},{default:n(()=>[r(g,{modelValue:e(o).name.ru,"onUpdate:modelValue":d[1]||(d[1]=l=>e(o).name.ru=l),placeholder:e(a)("admin.products.form.nameRuPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(u,{label:e(a)("admin.products.form.descriptionEn"),name:"description.en",required:""},{default:n(()=>[r(w,{modelValue:e(o).description.en,"onUpdate:modelValue":d[2]||(d[2]=l=>e(o).description.en=l),placeholder:e(a)("admin.products.form.descriptionEnPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(u,{label:e(a)("admin.products.form.descriptionRu"),name:"description.ru",required:""},{default:n(()=>[r(w,{modelValue:e(o).description.ru,"onUpdate:modelValue":d[3]||(d[3]=l=>e(o).description.ru=l),placeholder:e(a)("admin.products.form.descriptionRuPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])]),_:1}),r(V,null,{header:n(()=>[c("div",Oe,[c("h3",Te,b(e(a)("admin.products.form.categoryAndPrice")),1),r($,{icon:"i-lucide-plus",size:"xs",color:"primary",variant:"soft",onClick:_},{default:n(()=>[O(b(e(a)("admin.products.form.addPrice")),1)]),_:1})])]),default:n(()=>[c("div",Se,[r(u,{label:e(a)("admin.products.form.category"),name:"categoryId",required:""},{default:n(()=>[r(P,{modelValue:e(o).categoryId,"onUpdate:modelValue":d[4]||(d[4]=l=>e(o).categoryId=l),items:e(x).map(l=>({value:l.$id,label:l.name[v.$i18n.locale]})),"value-key":"value",placeholder:e(a)("admin.products.form.categoryPlaceholder")},null,8,["modelValue","items","placeholder"])]),_:1},8,["label"]),c("div",He,[(I(!0),E(J,null,Q(e(f),(l,q)=>(I(),E("div",{key:q,class:"flex items-end gap-2"},[r(u,{label:q===0?e(a)("admin.products.form.price"):"",class:"flex-1"},{default:n(()=>[r(g,{modelValue:l.price,"onUpdate:modelValue":D=>l.price=D,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),r(u,{label:q===0?e(a)("admin.products.form.currency"):"",class:"w-32"},{default:n(()=>[r(P,{"model-value":l.currency,items:m,"value-key":"value","onUpdate:modelValue":D=>l.currency=D},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),r(u,{label:q===0?e(a)("admin.products.form.priceUnit"):"",class:"w-32"},{default:n(()=>[r(P,{"model-value":l.period,items:i,"value-key":"value","onUpdate:modelValue":D=>l.period=D},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),e(f).length>1?(I(),W($,{key:0,icon:"i-lucide-trash-2",color:"red",variant:"soft",size:"sm",onClick:D=>F(q)},null,8,["onClick"])):M("",!0)]))),128))])])]),_:1}),r(V,null,{header:n(()=>[c("h3",Ne,b(e(a)("admin.products.images")),1)]),default:n(()=>[r(H,{modelValue:e(s),"onUpdate:modelValue":d[5]||(d[5]=l=>ue(s)?s.value=l:null),"max-images":5},null,8,["modelValue"])]),_:1}),r(V,null,{header:n(()=>[c("h3",je,b(e(a)("admin.products.form.settings")),1)]),default:n(()=>[c("div",Le,[r(u,{label:e(a)("admin.products.form.slug"),name:"slug",required:""},{help:n(()=>[c("span",We,b(e(a)("admin.products.form.slugHelp")),1)]),default:n(()=>[r(g,{modelValue:e(o).slug,"onUpdate:modelValue":d[6]||(d[6]=l=>e(o).slug=l),placeholder:e(a)("admin.products.form.slugPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(u,{label:e(a)("admin.products.form.sortOrder"),name:"sortOrder"},{default:n(()=>[r(g,{modelValue:e(o).sortOrder,"onUpdate:modelValue":d[7]||(d[7]=l=>e(o).sortOrder=l),modelModifiers:{number:!0},type:"number",min:"0"},null,8,["modelValue"])]),_:1},8,["label"]),c("div",ze,[r(u,{name:"isActive"},{default:n(()=>[r(N,{modelValue:e(o).isActive,"onUpdate:modelValue":d[8]||(d[8]=l=>e(o).isActive=l),label:e(a)("admin.products.form.isActive")},null,8,["modelValue","label"])]),_:1}),r(u,{name:"isAvailable"},{help:n(()=>[c("span",Ye,b(e(a)("admin.products.form.isAvailableHelp")),1)]),default:n(()=>[r(N,{modelValue:e(o).isAvailable,"onUpdate:modelValue":d[9]||(d[9]=l=>e(o).isAvailable=l),label:e(a)("admin.products.form.isAvailable")},null,8,["modelValue","label"])]),_:1})])])]),_:1}),c("div",Je,[r($,{color:"neutral",variant:"ghost",block:"",onClick:d[10]||(d[10]=l=>h("cancel"))},{default:n(()=>[O(b(e(a)("common.cancel")),1)]),_:1}),r($,{type:"submit",loading:p.loading,color:"primary",block:""},{default:n(()=>[O(b(p.product?e(a)("common.save"):e(a)("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["schema","state"])}}}),la=Object.assign(Qe,{__name:"ProductForm"});export{la as _};
