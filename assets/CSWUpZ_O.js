import{_ as ae}from"./Bao57lXT.js";import{_ as te}from"./CnpipSkh.js";import{o as j,n as oe,s as B,_ as le,a as re,b as se,c as Q}from"./qDZZ2L9P.js";import{_ as ne}from"./UFAAJMyF.js";import{r as E,L,R as de,e as G,f as K,g as ie,c as I,o as x,a as d,k as O,t as g,h as e,F as z,n as W,b as l,w as n,d as M,m as X,p as Y,j as ce,S as ue,H as me,l as pe,i as N,D as ge}from"./DJyH1og5.js";import{_ as fe}from"./BWLaKqo2.js";import{v as he,g as ve}from"./CBlsWPTx.js";import{u as _e,I as be}from"./DPXtLpAx.js";import{u as ye}from"./C5j0jcsD.js";const xe={maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"},Ve=async(f,F={})=>{const o={...xe,...F};return new Promise((b,a)=>{const w=new FileReader;w.onload=$=>{const V=new Image;V.onload=()=>{try{const t=document.createElement("canvas");let{width:v,height:c}=V;if(v>o.maxWidth||c>o.maxHeight){const p=Math.min(o.maxWidth/v,o.maxHeight/c);v=Math.round(v*p),c=Math.round(c*p)}t.width=v,t.height=c;const i=t.getContext("2d");if(!i){a(new Error("Failed to get canvas context"));return}i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(V,0,0,v,c),t.toBlob(p=>{if(!p){a(new Error("Failed to compress image"));return}const y=new File([p],f.name,{type:o.mimeType,lastModified:Date.now()});b(y)},o.mimeType,o.quality)}catch(t){a(t)}},V.onerror=()=>{a(new Error("Failed to load image"))},V.src=$.target?.result},w.onerror=()=>{a(new Error("Failed to read file"))},w.readAsDataURL(f)})};const we=()=>{const{storage:f}=_e(),F=de(),o=E(!1),b=E(0),a=E(null),w=E(!0),$=async(c,i=!0)=>{const p=he(c);if(!p.isValid)throw new Error(p.error);o.value=!0,a.value=null,b.value=0;try{let y=c;i&&w.value&&(b.value=10,y=await Ve(c,{maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"}),b.value=30);const A=be.unique(),C=F.public.appwriteBucketId;if(!C)throw new Error("Storage bucket ID is not configured");const D=await f.createFile(C,A,y);return b.value=100,D.$id}catch(y){const A=y instanceof Error?y.message:"Failed to upload image";throw a.value=A,new Error(A)}finally{o.value=!1}},V=async(c,i=!0)=>{const p=c.map(y=>$(y,i));return Promise.all(p)},t=async c=>{try{const i=F.public.appwriteBucketId;if(!i)throw new Error("Storage bucket ID is not configured");await f.deleteFile(i,c)}catch(i){const p=i instanceof Error?i.message:"Failed to delete image";throw a.value=p,new Error(p)}},v=async c=>{try{const i=F.public.appwriteBucketId;if(!i)throw new Error("Storage bucket ID is not configured");return await f.getFile(i,c)}catch(i){const p=i instanceof Error?i.message:"Failed to get image info";throw a.value=p,new Error(p)}};return{isUploading:L(o),uploadProgress:L(b),error:L(a),compressionEnabled:w,uploadImage:$,uploadImages:V,deleteImage:t,getImageInfo:v}},Ue={class:"space-y-4"},ke={class:"flex items-center justify-between"},Ie={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Fe={class:"text-xs text-gray-500"},$e={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Ee=["src","alt"],Ae={class:"absolute inset-0 flex items-center justify-center"},Ce=["disabled"],Pe={class:"space-y-2"},Re={class:"text-sm text-gray-600 dark:text-gray-400"},Be={class:"font-medium"},De={class:"text-xs mt-1"},qe={key:2,class:"text-sm text-red-600 dark:text-red-400"},Me=G({__name:"ImageUpload",props:{modelValue:{},maxImages:{default:5},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(f,{emit:F}){const o=f,b=F,{uploadImage:a,deleteImage:w,isUploading:$,error:V}=we(),{t}=K(),v=E(),c=E(!1),i=ie(()=>o.modelValue.length<o.maxImages),p=async _=>{if(!_||_.length===0)return;const u=o.maxImages-o.modelValue.length,r=Array.from(_).slice(0,u);try{for(const m of r){const h=await a(m);b("update:modelValue",[...o.modelValue,h])}}catch(m){console.error("Failed to upload images:",m)}},y=_=>{const u=_.target;p(u.files),u&&(u.value="")},A=_=>{_.preventDefault(),c.value=!1,!o.disabled&&p(_.dataTransfer?.files||null)},C=_=>{_.preventDefault(),c.value=!0},D=()=>{c.value=!1},S=async _=>{const u=o.modelValue[_];if(u)try{await w(u);const r=[...o.modelValue];r.splice(_,1),b("update:modelValue",r)}catch(r){console.error("Failed to delete image:",r)}},T=()=>{o.disabled||!i.value||v.value?.click()};return(_,u)=>{const r=X,m=ce;return x(),I("div",Ue,[d("div",ke,[d("label",Ie,g(e(t)("admin.images")),1),d("span",Fe,g(f.modelValue.length)+" / "+g(f.maxImages),1)]),f.modelValue.length>0?(x(),I("div",$e,[(x(!0),I(z,null,W(f.modelValue,(h,q)=>(x(),I("div",{key:h,class:"relative group aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden"},[d("img",{src:e(ve)(h),alt:`Image ${q+1}`,class:"w-full h-full object-cover"},null,8,Ee),d("div",Ae,[l(r,{color:"error",variant:"solid",size:"sm",icon:"i-lucide-trash-2",disabled:f.disabled,onClick:P=>S(q)},{default:n(()=>[M(g(e(t)("common.delete")),1)]),_:1},8,["disabled","onClick"])])]))),128))])):O("",!0),e(i)?(x(),I("div",{key:1,class:Y(["border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center cursor-pointer transition-colors duration-200",{"border-primary-500 bg-primary-50 dark:bg-primary-900/20":e(c),"hover:border-gray-400 dark:hover:border-gray-500":!f.disabled&&!e(c),"opacity-50 cursor-not-allowed":f.disabled}]),onClick:T,onDrop:A,onDragover:C,onDragleave:D},[d("input",{ref_key:"fileInput",ref:v,type:"file",multiple:"",accept:"image/jpeg,image/png,image/webp",class:"hidden",disabled:f.disabled,onChange:y},null,40,Ce),d("div",Pe,[l(m,{name:"i-lucide-upload",class:Y(["mx-auto text-4xl text-gray-400",{"animate-pulse":e($)}])},null,8,["class"]),d("div",Re,[d("p",Be,g(e($)?e(t)("admin.uploading"):e(t)("admin.clickToUpload")),1),d("p",null,g(e(t)("admin.dragAndDrop")),1),d("p",De,g(e(t)("admin.imageFormats"))+" ("+g(e(t)("admin.maxSize"))+": 5MB)",1)])])],34)):O("",!0),e(V)?(x(),I("div",qe,g(e(V)),1)):O("",!0)])}}}),Oe=Object.assign(Me,{__name:"ImageUpload"}),Se={class:"text-base font-semibold"},Te={class:"space-y-4"},He={class:"flex items-center justify-between"},je={class:"text-base font-semibold"},Le={class:"space-y-4"},Ne={class:"space-y-2"},ze={class:"text-xs text-muted-foreground"},We={class:"space-y-3"},Ye={class:"text-base font-semibold"},Je={class:"flex items-center justify-between"},Qe={class:"text-base font-semibold"},Ge={class:"space-y-4"},Ke={class:"flex items-start gap-2"},Xe={class:"flex-1 space-y-2"},Ze={class:"text-base font-semibold"},ea={class:"space-y-4"},aa={class:"text-xs text-muted-foreground"},ta={class:"space-y-3"},oa={class:"text-xs text-muted-foreground"},la={class:"flex items-center space-x-2"},ra=G({__name:"ProductForm",props:{product:{},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(f,{emit:F}){const o=f,b=F,{t:a}=K(),{categories:w,fetchCategories:$}=ye(),V=j({name:j({en:B().min(1,a("admin.products.errors.nameEnRequired")),ru:B().min(1,a("admin.products.errors.nameRuRequired"))}),description:j({en:B().min(1,a("admin.products.errors.descriptionEnRequired")),ru:B().min(1,a("admin.products.errors.descriptionRuRequired"))}),categoryId:B().min(1,a("admin.products.errors.categoryRequired")),slug:B().min(1,a("admin.products.errors.slugRequired")),sortOrder:oe().min(0),isActive:Q(),isAvailable:Q()}),t=ue({name:{en:o.product?.name.en||"",ru:o.product?.name.ru||""},description:{en:o.product?.description.en||"",ru:o.product?.description.ru||""},categoryId:o.product?.categoryId||"",slug:o.product?.slug||"",sortOrder:o.product?.sortOrder||0,isActive:o.product?.isActive??!0,isAvailable:o.product?.isAvailable??!0}),v=E(o.product?.pricing&&o.product.pricing.length>0?o.product.pricing.map(u=>({...u})):[{period:"day",price:0,currency:"₽"}]),c=E(o.product?.images?[...o.product.images]:[]),i=E(o.product?.features&&(o.product.features.en.length>0||o.product.features.ru.length>0)?Array.from({length:Math.max(o.product.features.en.length,o.product.features.ru.length)},(u,r)=>({en:o.product.features.en[r]||"",ru:o.product.features.ru[r]||""})):[{en:"",ru:""}]),p=[{value:"hour",label:a("admin.products.priceUnits.hour")},{value:"day",label:a("admin.products.priceUnits.day")},{value:"week",label:a("admin.products.priceUnits.week")},{value:"month",label:a("admin.products.priceUnits.month")}],y=[{value:"₽",label:"₽ (RUB)"},{value:"$",label:"$ (USD)"},{value:"€",label:"€ (EUR)"},{value:"฿",label:"฿ (THB)"},{value:"¥",label:"¥ (CNY/JPY)"}],A=()=>{v.value.push({period:"day",price:0,currency:"₽"})},C=u=>{v.value.length>1&&v.value.splice(u,1)},D=()=>{i.value.push({en:"",ru:""})},S=u=>{i.value.length>1&&i.value.splice(u,1)},T=u=>u.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();me(()=>t.name.en,u=>{!o.product&&u&&(t.slug=T(u))}),pe(async()=>{w.value.length||await $()});const _=async()=>{const u=i.value.filter(m=>m.en.trim()||m.ru.trim()),r={name:t.name,description:t.description,categoryId:t.categoryId,pricing:v.value.filter(m=>m.price>0),images:c.value,slug:t.slug,features:{en:u.map(m=>m.en.trim()).filter(Boolean),ru:u.map(m=>m.ru.trim()).filter(Boolean)},sortOrder:t.sortOrder,isActive:t.isActive,isAvailable:t.isAvailable};b("submit",r)};return(u,r)=>{const m=ae,h=te,q=re,P=ne,R=X,H=fe,Z=Oe,J=se,ee=le;return x(),N(ee,{schema:e(V),state:e(t),class:"space-y-4",onSubmit:_},{default:n(()=>[l(P,null,{header:n(()=>[d("h3",Se,g(e(a)("admin.products.form.basicInfo")),1)]),default:n(()=>[d("div",Te,[l(h,{label:e(a)("admin.products.form.nameEn"),name:"name.en",required:""},{default:n(()=>[l(m,{modelValue:e(t).name.en,"onUpdate:modelValue":r[0]||(r[0]=s=>e(t).name.en=s),placeholder:e(a)("admin.products.form.nameEnPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(h,{label:e(a)("admin.products.form.nameRu"),name:"name.ru",required:""},{default:n(()=>[l(m,{modelValue:e(t).name.ru,"onUpdate:modelValue":r[1]||(r[1]=s=>e(t).name.ru=s),placeholder:e(a)("admin.products.form.nameRuPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(h,{label:e(a)("admin.products.form.descriptionEn"),name:"description.en",required:""},{default:n(()=>[l(q,{modelValue:e(t).description.en,"onUpdate:modelValue":r[2]||(r[2]=s=>e(t).description.en=s),placeholder:e(a)("admin.products.form.descriptionEnPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(h,{label:e(a)("admin.products.form.descriptionRu"),name:"description.ru",required:""},{default:n(()=>[l(q,{modelValue:e(t).description.ru,"onUpdate:modelValue":r[3]||(r[3]=s=>e(t).description.ru=s),placeholder:e(a)("admin.products.form.descriptionRuPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])]),_:1}),l(P,null,{header:n(()=>[d("div",He,[d("h3",je,g(e(a)("admin.products.form.categoryAndPrice")),1),l(R,{icon:"i-lucide-plus",size:"xs",color:"primary",variant:"soft",onClick:A},{default:n(()=>[M(g(e(a)("admin.products.form.addPrice")),1)]),_:1})])]),default:n(()=>[d("div",Le,[l(h,{label:e(a)("admin.products.form.category"),name:"categoryId",required:""},{default:n(()=>[l(H,{modelValue:e(t).categoryId,"onUpdate:modelValue":r[4]||(r[4]=s=>e(t).categoryId=s),items:e(w).map(s=>({value:s.$id,label:s.name[u.$i18n.locale]})),"value-key":"value",placeholder:e(a)("admin.products.form.categoryPlaceholder")},null,8,["modelValue","items","placeholder"])]),_:1},8,["label"]),d("div",Ne,[d("p",ze,g(e(a)("admin.products.form.priceOptional")),1),d("div",We,[(x(!0),I(z,null,W(e(v),(s,U)=>(x(),I("div",{key:U,class:"flex items-end gap-2"},[l(h,{label:U===0?e(a)("admin.products.form.price"):"",class:"flex-1"},{default:n(()=>[l(m,{modelValue:s.price,"onUpdate:modelValue":k=>s.price=k,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),l(h,{label:U===0?e(a)("admin.products.form.currency"):"",class:"w-32"},{default:n(()=>[l(H,{"model-value":s.currency,items:y,"value-key":"value","onUpdate:modelValue":k=>s.currency=k},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),l(h,{label:U===0?e(a)("admin.products.form.priceUnit"):"",class:"w-32"},{default:n(()=>[l(H,{"model-value":s.period,items:p,"value-key":"value","onUpdate:modelValue":k=>s.period=k},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),e(v).length>1?(x(),N(R,{key:0,icon:"i-lucide-trash-2",color:"error",variant:"soft",size:"sm",onClick:k=>C(U)},null,8,["onClick"])):O("",!0)]))),128))])])])]),_:1}),l(P,null,{header:n(()=>[d("h3",Ye,g(e(a)("admin.products.images")),1)]),default:n(()=>[l(Z,{modelValue:e(c),"onUpdate:modelValue":r[5]||(r[5]=s=>ge(c)?c.value=s:null),"max-images":5},null,8,["modelValue"])]),_:1}),l(P,null,{header:n(()=>[d("div",Je,[d("h3",Qe,g(e(a)("admin.products.form.features")),1),l(R,{icon:"i-lucide-plus",size:"xs",color:"primary",variant:"soft",onClick:D},{default:n(()=>[M(g(e(a)("admin.products.form.addFeature")),1)]),_:1})])]),default:n(()=>[d("div",Ge,[(x(!0),I(z,null,W(e(i),(s,U)=>(x(),I("div",{key:U,class:"space-y-2"},[d("div",Ke,[d("div",Xe,[l(h,{label:U===0?e(a)("admin.products.form.featuresEn"):""},{default:n(()=>[l(m,{modelValue:s.en,"onUpdate:modelValue":k=>s.en=k,placeholder:e(a)("admin.products.form.featureEnPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]),l(h,{label:U===0?e(a)("admin.products.form.featuresRu"):""},{default:n(()=>[l(m,{modelValue:s.ru,"onUpdate:modelValue":k=>s.ru=k,placeholder:e(a)("admin.products.form.featureRuPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])]),e(i).length>1?(x(),N(R,{key:0,icon:"i-lucide-trash-2",color:"error",variant:"soft",size:"sm",class:Y({"mt-6":U===0}),onClick:k=>S(U)},null,8,["class","onClick"])):O("",!0)])]))),128))])]),_:1}),l(P,null,{header:n(()=>[d("h3",Ze,g(e(a)("admin.products.form.settings")),1)]),default:n(()=>[d("div",ea,[l(h,{label:e(a)("admin.products.form.slug"),name:"slug",required:""},{help:n(()=>[d("span",aa,g(e(a)("admin.products.form.slugHelp")),1)]),default:n(()=>[l(m,{modelValue:e(t).slug,"onUpdate:modelValue":r[6]||(r[6]=s=>e(t).slug=s),placeholder:e(a)("admin.products.form.slugPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(h,{label:e(a)("admin.products.form.sortOrder"),name:"sortOrder"},{default:n(()=>[l(m,{modelValue:e(t).sortOrder,"onUpdate:modelValue":r[7]||(r[7]=s=>e(t).sortOrder=s),modelModifiers:{number:!0},type:"number",min:"0"},null,8,["modelValue"])]),_:1},8,["label"]),d("div",ta,[l(h,{name:"isActive"},{default:n(()=>[l(J,{modelValue:e(t).isActive,"onUpdate:modelValue":r[8]||(r[8]=s=>e(t).isActive=s),label:e(a)("admin.products.form.isActive")},null,8,["modelValue","label"])]),_:1}),l(h,{name:"isAvailable"},{help:n(()=>[d("span",oa,g(e(a)("admin.products.form.isAvailableHelp")),1)]),default:n(()=>[l(J,{modelValue:e(t).isAvailable,"onUpdate:modelValue":r[9]||(r[9]=s=>e(t).isAvailable=s),label:e(a)("admin.products.form.isAvailable")},null,8,["modelValue","label"])]),_:1})])])]),_:1}),d("div",la,[l(R,{color:"neutral",variant:"ghost",block:"",onClick:r[10]||(r[10]=s=>b("cancel"))},{default:n(()=>[M(g(e(a)("common.cancel")),1)]),_:1}),l(R,{type:"submit",loading:f.loading,color:"primary",block:""},{default:n(()=>[M(g(f.product?e(a)("common.save"):e(a)("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["schema","state"])}}}),fa=Object.assign(ra,{__name:"ProductForm"});export{fa as _};
