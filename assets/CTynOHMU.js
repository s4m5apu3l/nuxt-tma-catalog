import{u as J,I as $,Q as u}from"./BkcUQ56Y.js";import{u as x}from"./Bg3rBmSY.js";import{S as B,M as p,r as v}from"./CGidw6B-.js";const a=v([]),o=v(!1),n=v(null),m=v(0),q=300*1e3,g=t=>({...t,name:typeof t.name=="string"?JSON.parse(t.name):t.name,description:typeof t.description=="string"?JSON.parse(t.description):t.description}),T=()=>{const{databases:t}=J(),{handleError:l,handleSuccess:y}=x(),C=B(),c=C.public.appwriteBdKey,i=C.public.appwriteCollectionCategories,A=()=>Date.now()-m.value<q&&a.value.length>0,D=async(r=!1)=>{if(!(!r&&A())){o.value=!0,n.value=null;try{const e=await t.listDocuments(c,i,[u.equal("isActive",!0),u.orderAsc("sortOrder"),u.orderDesc("$createdAt")]);a.value=e.documents.map(g),m.value=Date.now()}catch(e){console.error("Error fetching categories:",e),n.value="Failed to fetch categories",l(e,"Ошибка загрузки категорий")}finally{o.value=!1}}},O=async r=>{o.value=!0,n.value=null;try{const e=await t.createDocument(c,i,$.unique(),{...r,name:JSON.stringify(r.name),description:JSON.stringify(r.description),sortOrder:r.sortOrder??0,isActive:r.isActive??!0}),s=g(e);return a.value.push(s),a.value.sort((f,d)=>f.sortOrder-d.sortOrder),y("Категория успешно создана"),s}catch(e){return console.error("Error creating category:",e),n.value="Failed to create category",l(e,"Ошибка создания категории"),null}finally{o.value=!1}},w=async r=>{o.value=!0,n.value=null;try{const{$id:e,...s}=r,f=await t.updateDocument(c,i,e,{...s,name:JSON.stringify(s.name),description:JSON.stringify(s.description)}),d=g(f),h=a.value.findIndex(I=>I.$id===e);return h!==-1&&(a.value[h]=d),y("Категория успешно обновлена"),d}catch(e){return console.error("Error updating category:",e),n.value="Failed to update category",l(e,"Ошибка обновления категории"),null}finally{o.value=!1}},E=async r=>{o.value=!0,n.value=null;try{return await t.deleteDocument(c,i,r),a.value=a.value.filter(e=>e.$id!==r),y("Категория успешно удалена"),!0}catch(e){return console.error("Error deleting category:",e),n.value="Failed to delete category",l(e,"Ошибка удаления категории"),!1}finally{o.value=!1}},S=r=>a.value.find(e=>e.slug===r),b=r=>a.value.find(e=>e.$id===r),N=async()=>{o.value=!0,n.value=null;try{const r=await t.listDocuments(c,i,[u.orderAsc("sortOrder"),u.orderDesc("$createdAt")]);a.value=r.documents.map(g),m.value=Date.now()}catch(r){console.error("Error fetching all categories:",r),n.value="Failed to fetch all categories",l(r,"Ошибка загрузки всех категорий")}finally{o.value=!1}},F=()=>a.value.filter(r=>r.isActive);return{categories:p(a),loading:p(o),error:p(n),fetchCategories:D,fetchAllCategories:N,createCategory:O,updateCategory:w,deleteCategory:E,getCategoryBySlug:S,getCategoryById:b,getActiveCategories:F}};export{T as u};
