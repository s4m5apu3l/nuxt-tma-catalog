import{_ as ae}from"./BDkpP-oW.js";import{_ as te}from"./R4sJ_hm3.js";import{o as j,n as oe,s as C,_ as re,a as le,b as se,c as Q}from"./DPNwsPOR.js";import{_ as ne}from"./CcKe6E5P.js";import{r as E,M as N,V as de,e as G,f as K,g as ie,c as I,o as x,a as d,k as O,t as p,h as e,F as L,n as W,b as r,w as n,d as M,m as X,p as Y,j as ce,W as ue,H as me,l as pe,i as z,D as ge}from"./DNRPXmkd.js";import{_ as fe}from"./Dswxp5HA.js";import{v as he,g as _e}from"./DjSR4xoZ.js";import{u as ve,I as be}from"./BxcJFf2F.js";import{u as ye}from"./36WdM4Mw.js";const xe={maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"},Ve=async(f,F={})=>{const o={...xe,...F};return new Promise((b,a)=>{const U=new FileReader;U.onload=$=>{const V=new Image;V.onload=()=>{try{const t=document.createElement("canvas");let{width:_,height:c}=V;if(_>o.maxWidth||c>o.maxHeight){const g=Math.min(o.maxWidth/_,o.maxHeight/c);_=Math.round(_*g),c=Math.round(c*g)}t.width=_,t.height=c;const i=t.getContext("2d");if(!i){a(new Error("Failed to get canvas context"));return}i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(V,0,0,_,c),t.toBlob(g=>{if(!g){a(new Error("Failed to compress image"));return}const y=new File([g],f.name,{type:o.mimeType,lastModified:Date.now()});b(y)},o.mimeType,o.quality)}catch(t){a(t)}},V.onerror=()=>{a(new Error("Failed to load image"))},V.src=$.target?.result},U.onerror=()=>{a(new Error("Failed to read file"))},U.readAsDataURL(f)})};const Ue=()=>{const{storage:f}=ve(),F=de(),o=E(!1),b=E(0),a=E(null),U=E(!0),$=async(c,i=!0)=>{const g=he(c);if(!g.isValid)throw new Error(g.error);o.value=!0,a.value=null,b.value=0;try{let y=c;i&&U.value&&(b.value=10,y=await Ve(c,{maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"}),b.value=30);const A=be.unique(),P=F.public.appwriteBucketId;if(!P)throw new Error("Storage bucket ID is not configured");const D=await f.createFile(P,A,y);return b.value=100,D.$id}catch(y){const A=y instanceof Error?y.message:"Failed to upload image";throw a.value=A,new Error(A)}finally{o.value=!1}},V=async(c,i=!0)=>{const g=c.map(y=>$(y,i));return Promise.all(g)},t=async c=>{try{const i=F.public.appwriteBucketId;if(!i)throw new Error("Storage bucket ID is not configured");await f.deleteFile(i,c)}catch(i){const g=i instanceof Error?i.message:"Failed to delete image";throw a.value=g,new Error(g)}},_=async c=>{try{const i=F.public.appwriteBucketId;if(!i)throw new Error("Storage bucket ID is not configured");return await f.getFile(i,c)}catch(i){const g=i instanceof Error?i.message:"Failed to get image info";throw a.value=g,new Error(g)}};return{isUploading:N(o),uploadProgress:N(b),error:N(a),compressionEnabled:U,uploadImage:$,uploadImages:V,deleteImage:t,getImageInfo:_}},we={class:"space-y-4"},ke={class:"flex items-center justify-between"},Ie={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Fe={class:"text-xs text-gray-500"},$e={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Ee=["src","alt"],Ae={class:"absolute inset-0 flex items-center justify-center"},Ce=["disabled"],Pe={class:"space-y-2"},Re={class:"text-sm text-gray-600 dark:text-gray-400"},Be={class:"font-medium"},De={class:"text-xs mt-1"},qe={key:2,class:"text-sm text-red-600 dark:text-red-400"},Me=G({__name:"ImageUpload",props:{modelValue:{},maxImages:{default:5},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(f,{emit:F}){const o=f,b=F,{uploadImage:a,deleteImage:U,isUploading:$,error:V}=Ue(),{t}=K(),_=E(),c=E(!1),i=ie(()=>o.modelValue.length<o.maxImages),g=async v=>{if(!v||v.length===0)return;const u=o.maxImages-o.modelValue.length,l=Array.from(v).slice(0,u);try{for(const m of l){const h=await a(m);b("update:modelValue",[...o.modelValue,h])}}catch(m){console.error("Failed to upload images:",m)}},y=v=>{const u=v.target;g(u.files),u&&(u.value="")},A=v=>{v.preventDefault(),c.value=!1,!o.disabled&&g(v.dataTransfer?.files||null)},P=v=>{v.preventDefault(),c.value=!0},D=()=>{c.value=!1},T=async v=>{const u=o.modelValue[v];if(u)try{await U(u);const l=[...o.modelValue];l.splice(v,1),b("update:modelValue",l)}catch(l){console.error("Failed to delete image:",l)}},S=()=>{o.disabled||!i.value||_.value?.click()};return(v,u)=>{const l=X,m=ce;return x(),I("div",we,[d("div",ke,[d("label",Ie,p(e(t)("admin.images")),1),d("span",Fe,p(f.modelValue.length)+" / "+p(f.maxImages),1)]),f.modelValue.length>0?(x(),I("div",$e,[(x(!0),I(L,null,W(f.modelValue,(h,q)=>(x(),I("div",{key:h,class:"relative group aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden"},[d("img",{src:e(_e)(h),alt:`Image ${q+1}`,class:"w-full h-full object-cover"},null,8,Ee),d("div",Ae,[r(l,{color:"error",variant:"solid",size:"sm",icon:"i-lucide-trash-2",disabled:f.disabled,onClick:R=>T(q)},{default:n(()=>[M(p(e(t)("common.delete")),1)]),_:1},8,["disabled","onClick"])])]))),128))])):O("",!0),e(i)?(x(),I("div",{key:1,class:Y(["border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center cursor-pointer transition-colors duration-200",{"border-primary-500 bg-primary-50 dark:bg-primary-900/20":e(c),"hover:border-gray-400 dark:hover:border-gray-500":!f.disabled&&!e(c),"opacity-50 cursor-not-allowed":f.disabled}]),onClick:S,onDrop:A,onDragover:P,onDragleave:D},[d("input",{ref_key:"fileInput",ref:_,type:"file",multiple:"",accept:"image/jpeg,image/png,image/webp",class:"hidden",disabled:f.disabled,onChange:y},null,40,Ce),d("div",Pe,[r(m,{name:"i-lucide-upload",class:Y(["mx-auto text-4xl text-gray-400",{"animate-pulse":e($)}])},null,8,["class"]),d("div",Re,[d("p",Be,p(e($)?e(t)("admin.uploading"):e(t)("admin.clickToUpload")),1),d("p",null,p(e(t)("admin.dragAndDrop")),1),d("p",De,p(e(t)("admin.imageFormats"))+" ("+p(e(t)("admin.maxSize"))+": 5MB)",1)])])],34)):O("",!0),e(V)?(x(),I("div",qe,p(e(V)),1)):O("",!0)])}}}),Oe=Object.assign(Me,{__name:"ImageUpload"}),Te={class:"text-base font-semibold"},Se={class:"space-y-4"},He={class:"flex items-center justify-between"},je={class:"text-base font-semibold"},Ne={class:"space-y-4"},ze={class:"space-y-2"},Le={class:"text-xs text-muted-foreground"},We={class:"space-y-3"},Ye={class:"text-base font-semibold"},Je={class:"flex items-center justify-between"},Qe={class:"text-base font-semibold"},Ge={class:"space-y-4"},Ke={class:"flex items-start gap-2"},Xe={class:"flex-1 space-y-2"},Ze={class:"text-base font-semibold"},ea={class:"space-y-4"},aa={class:"text-xs text-muted-foreground"},ta={class:"text-xs text-muted-foreground"},oa={class:"space-y-3"},ra={class:"text-xs text-muted-foreground"},la={class:"flex items-center space-x-2"},sa=G({__name:"ProductForm",props:{product:{},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(f,{emit:F}){const o=f,b=F,{t:a}=K(),{categories:U,fetchCategories:$}=ye(),V=j({name:j({en:C().min(1,a("admin.products.errors.nameEnRequired")),ru:C().min(1,a("admin.products.errors.nameRuRequired"))}),description:j({en:C().min(1,a("admin.products.errors.descriptionEnRequired")),ru:C().min(1,a("admin.products.errors.descriptionRuRequired"))}),categoryId:C().min(1,a("admin.products.errors.categoryRequired")),slug:C().min(1,a("admin.products.errors.slugRequired")),contactUsername:C().min(1,a("admin.products.errors.contactUsernameRequired")),sortOrder:oe().min(0),isActive:Q(),isAvailable:Q()}),t=ue({name:{en:o.product?.name.en||"",ru:o.product?.name.ru||""},description:{en:o.product?.description.en||"",ru:o.product?.description.ru||""},categoryId:o.product?.categoryId||"",slug:o.product?.slug||"",contactUsername:o.product?.contactUsername||"",sortOrder:o.product?.sortOrder||0,isActive:o.product?.isActive??!0,isAvailable:o.product?.isAvailable??!0}),_=E(o.product?.pricing&&o.product.pricing.length>0?o.product.pricing.map(u=>({...u})):[{period:"day",price:0,currency:"₽"}]),c=E(o.product?.images?[...o.product.images]:[]),i=E(o.product?.features&&(o.product.features.en.length>0||o.product.features.ru.length>0)?Array.from({length:Math.max(o.product.features.en.length,o.product.features.ru.length)},(u,l)=>({en:o.product.features.en[l]||"",ru:o.product.features.ru[l]||""})):[{en:"",ru:""}]),g=[{value:"hour",label:a("admin.products.priceUnits.hour")},{value:"day",label:a("admin.products.priceUnits.day")},{value:"week",label:a("admin.products.priceUnits.week")},{value:"month",label:a("admin.products.priceUnits.month")}],y=[{value:"₽",label:"₽ (RUB)"},{value:"$",label:"$ (USD)"},{value:"€",label:"€ (EUR)"},{value:"฿",label:"฿ (THB)"},{value:"¥",label:"¥ (CNY/JPY)"}],A=()=>{_.value.push({period:"day",price:0,currency:"₽"})},P=u=>{_.value.length>1&&_.value.splice(u,1)},D=()=>{i.value.push({en:"",ru:""})},T=u=>{i.value.length>1&&i.value.splice(u,1)},S=u=>u.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();me(()=>t.name.en,u=>{!o.product&&u&&(t.slug=S(u))}),pe(async()=>{U.value.length||await $()});const v=async()=>{const u=i.value.filter(m=>m.en.trim()||m.ru.trim()),l={name:t.name,description:t.description,categoryId:t.categoryId,pricing:_.value.filter(m=>m.price>0),images:c.value,slug:t.slug,features:{en:u.map(m=>m.en.trim()).filter(Boolean),ru:u.map(m=>m.ru.trim()).filter(Boolean)},sortOrder:t.sortOrder,isActive:t.isActive,isAvailable:t.isAvailable,contactUsername:t.contactUsername.trim()};b("submit",l)};return(u,l)=>{const m=ae,h=te,q=le,R=ne,B=X,H=fe,Z=Oe,J=se,ee=re;return x(),z(ee,{schema:e(V),state:e(t),class:"space-y-4",onSubmit:v},{default:n(()=>[r(R,null,{header:n(()=>[d("h3",Te,p(e(a)("admin.products.form.basicInfo")),1)]),default:n(()=>[d("div",Se,[r(h,{label:e(a)("admin.products.form.nameEn"),name:"name.en",required:""},{default:n(()=>[r(m,{modelValue:e(t).name.en,"onUpdate:modelValue":l[0]||(l[0]=s=>e(t).name.en=s),placeholder:e(a)("admin.products.form.nameEnPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(h,{label:e(a)("admin.products.form.nameRu"),name:"name.ru",required:""},{default:n(()=>[r(m,{modelValue:e(t).name.ru,"onUpdate:modelValue":l[1]||(l[1]=s=>e(t).name.ru=s),placeholder:e(a)("admin.products.form.nameRuPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(h,{label:e(a)("admin.products.form.descriptionEn"),name:"description.en",required:""},{default:n(()=>[r(q,{modelValue:e(t).description.en,"onUpdate:modelValue":l[2]||(l[2]=s=>e(t).description.en=s),placeholder:e(a)("admin.products.form.descriptionEnPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(h,{label:e(a)("admin.products.form.descriptionRu"),name:"description.ru",required:""},{default:n(()=>[r(q,{modelValue:e(t).description.ru,"onUpdate:modelValue":l[3]||(l[3]=s=>e(t).description.ru=s),placeholder:e(a)("admin.products.form.descriptionRuPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])]),_:1}),r(R,null,{header:n(()=>[d("div",He,[d("h3",je,p(e(a)("admin.products.form.categoryAndPrice")),1),r(B,{icon:"i-lucide-plus",size:"xs",color:"primary",variant:"soft",onClick:A},{default:n(()=>[M(p(e(a)("admin.products.form.addPrice")),1)]),_:1})])]),default:n(()=>[d("div",Ne,[r(h,{label:e(a)("admin.products.form.category"),name:"categoryId",required:""},{default:n(()=>[r(H,{modelValue:e(t).categoryId,"onUpdate:modelValue":l[4]||(l[4]=s=>e(t).categoryId=s),items:e(U).map(s=>({value:s.$id,label:s.name[u.$i18n.locale]})),"value-key":"value",placeholder:e(a)("admin.products.form.categoryPlaceholder")},null,8,["modelValue","items","placeholder"])]),_:1},8,["label"]),d("div",ze,[d("p",Le,p(e(a)("admin.products.form.priceOptional")),1),d("div",We,[(x(!0),I(L,null,W(e(_),(s,w)=>(x(),I("div",{key:w,class:"flex items-end gap-2"},[r(h,{label:w===0?e(a)("admin.products.form.price"):"",class:"flex-1"},{default:n(()=>[r(m,{modelValue:s.price,"onUpdate:modelValue":k=>s.price=k,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),r(h,{label:w===0?e(a)("admin.products.form.currency"):"",class:"w-32"},{default:n(()=>[r(H,{"model-value":s.currency,items:y,"value-key":"value","onUpdate:modelValue":k=>s.currency=k},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),r(h,{label:w===0?e(a)("admin.products.form.priceUnit"):"",class:"w-32"},{default:n(()=>[r(H,{"model-value":s.period,items:g,"value-key":"value","onUpdate:modelValue":k=>s.period=k},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),e(_).length>1?(x(),z(B,{key:0,icon:"i-lucide-trash-2",color:"error",variant:"soft",size:"sm",onClick:k=>P(w)},null,8,["onClick"])):O("",!0)]))),128))])])])]),_:1}),r(R,null,{header:n(()=>[d("h3",Ye,p(e(a)("admin.products.images")),1)]),default:n(()=>[r(Z,{modelValue:e(c),"onUpdate:modelValue":l[5]||(l[5]=s=>ge(c)?c.value=s:null),"max-images":5},null,8,["modelValue"])]),_:1}),r(R,null,{header:n(()=>[d("div",Je,[d("h3",Qe,p(e(a)("admin.products.form.features")),1),r(B,{icon:"i-lucide-plus",size:"xs",color:"primary",variant:"soft",onClick:D},{default:n(()=>[M(p(e(a)("admin.products.form.addFeature")),1)]),_:1})])]),default:n(()=>[d("div",Ge,[(x(!0),I(L,null,W(e(i),(s,w)=>(x(),I("div",{key:w,class:"space-y-2"},[d("div",Ke,[d("div",Xe,[r(h,{label:w===0?e(a)("admin.products.form.featuresEn"):""},{default:n(()=>[r(m,{modelValue:s.en,"onUpdate:modelValue":k=>s.en=k,placeholder:e(a)("admin.products.form.featureEnPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]),r(h,{label:w===0?e(a)("admin.products.form.featuresRu"):""},{default:n(()=>[r(m,{modelValue:s.ru,"onUpdate:modelValue":k=>s.ru=k,placeholder:e(a)("admin.products.form.featureRuPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])]),e(i).length>1?(x(),z(B,{key:0,icon:"i-lucide-trash-2",color:"error",variant:"soft",size:"sm",class:Y({"mt-6":w===0}),onClick:k=>T(w)},null,8,["class","onClick"])):O("",!0)])]))),128))])]),_:1}),r(R,null,{header:n(()=>[d("h3",Ze,p(e(a)("admin.products.form.settings")),1)]),default:n(()=>[d("div",ea,[r(h,{label:e(a)("admin.products.form.slug"),name:"slug",required:""},{help:n(()=>[d("span",aa,p(e(a)("admin.products.form.slugHelp")),1)]),default:n(()=>[r(m,{modelValue:e(t).slug,"onUpdate:modelValue":l[6]||(l[6]=s=>e(t).slug=s),placeholder:e(a)("admin.products.form.slugPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(h,{label:e(a)("product.contact.username_label"),name:"contactUsername",required:""},{help:n(()=>[d("span",ta,p(e(a)("product.contact.username_help")),1)]),default:n(()=>[r(m,{modelValue:e(t).contactUsername,"onUpdate:modelValue":l[7]||(l[7]=s=>e(t).contactUsername=s),placeholder:e(a)("product.contact.username_placeholder"),icon:"i-lucide-at-sign"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(h,{label:e(a)("admin.products.form.sortOrder"),name:"sortOrder"},{default:n(()=>[r(m,{modelValue:e(t).sortOrder,"onUpdate:modelValue":l[8]||(l[8]=s=>e(t).sortOrder=s),modelModifiers:{number:!0},type:"number",min:"0"},null,8,["modelValue"])]),_:1},8,["label"]),d("div",oa,[r(h,{name:"isActive"},{default:n(()=>[r(J,{modelValue:e(t).isActive,"onUpdate:modelValue":l[9]||(l[9]=s=>e(t).isActive=s),label:e(a)("admin.products.form.isActive")},null,8,["modelValue","label"])]),_:1}),r(h,{name:"isAvailable"},{help:n(()=>[d("span",ra,p(e(a)("admin.products.form.isAvailableHelp")),1)]),default:n(()=>[r(J,{modelValue:e(t).isAvailable,"onUpdate:modelValue":l[10]||(l[10]=s=>e(t).isAvailable=s),label:e(a)("admin.products.form.isAvailable")},null,8,["modelValue","label"])]),_:1})])])]),_:1}),d("div",la,[r(B,{color:"neutral",variant:"ghost",block:"",onClick:l[11]||(l[11]=s=>b("cancel"))},{default:n(()=>[M(p(e(a)("common.cancel")),1)]),_:1}),r(B,{type:"submit",loading:f.loading,color:"primary",block:""},{default:n(()=>[M(p(f.product?e(a)("common.save"):e(a)("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["schema","state"])}}}),ha=Object.assign(sa,{__name:"ProductForm"});export{ha as _};
