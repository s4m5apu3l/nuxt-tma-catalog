import{_ as ae}from"./CMD25UQU.js";import{_ as te}from"./23Ciljqi.js";import{o as j,n as oe,s as C,_ as re,a as le,b as se,c as J}from"./CeiKXweL.js";import{_ as ne}from"./B_TSKWP7.js";import{r as $,U as N,W as de,e as X,f as G,g as ie,c as k,o as x,a as n,k as O,t as m,h as e,F as L,n as W,b as l,w as d,d as M,m as K,p as Q,j as ce,X as ue,E as me,l as pe,i as z,I as ge}from"./DfwlhHKt.js";import{_ as fe}from"./BLbMU7rF.js";import{v as he,g as _e}from"./1geHj3CL.js";import{u as ve,I as be}from"./BjOuhSb3.js";import{u as ye}from"./DZtT2Z-4.js";const xe={maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"},Ve=async(f,I={})=>{const o={...xe,...I};return new Promise((b,a)=>{const U=new FileReader;U.onload=F=>{const V=new Image;V.onload=()=>{try{const t=document.createElement("canvas");let{width:h,height:c}=V;if(h>o.maxWidth||c>o.maxHeight){const g=Math.min(o.maxWidth/h,o.maxHeight/c);h=Math.round(h*g),c=Math.round(c*g)}t.width=h,t.height=c;const i=t.getContext("2d");if(!i){a(new Error("Failed to get canvas context"));return}i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(V,0,0,h,c),t.toBlob(g=>{if(!g){a(new Error("Failed to compress image"));return}const y=new File([g],f.name,{type:o.mimeType,lastModified:Date.now()});b(y)},o.mimeType,o.quality)}catch(t){a(t)}},V.onerror=()=>{a(new Error("Failed to load image"))},V.src=F.target?.result},U.onerror=()=>{a(new Error("Failed to read file"))},U.readAsDataURL(f)})};const Ue=()=>{const{storage:f}=ve(),I=de(),o=$(!1),b=$(0),a=$(null),U=$(!0),F=async(c,i=!0)=>{const g=he(c);if(!g.isValid)throw new Error(g.error);o.value=!0,a.value=null,b.value=0;try{let y=c;i&&U.value&&(b.value=10,y=await Ve(c,{maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"}),b.value=30);const E=be.unique(),P=I.public.appwriteBucketId;if(!P)throw new Error("Storage bucket ID is not configured");const q=await f.createFile(P,E,y);return b.value=100,q.$id}catch(y){const E=y instanceof Error?y.message:"Failed to upload image";throw a.value=E,new Error(E)}finally{o.value=!1}},V=async(c,i=!0)=>{const g=c.map(y=>F(y,i));return Promise.all(g)},t=async c=>{try{const i=I.public.appwriteBucketId;if(!i)throw new Error("Storage bucket ID is not configured");await f.deleteFile(i,c)}catch(i){const g=i instanceof Error?i.message:"Failed to delete image";throw a.value=g,new Error(g)}},h=async c=>{try{const i=I.public.appwriteBucketId;if(!i)throw new Error("Storage bucket ID is not configured");return await f.getFile(i,c)}catch(i){const g=i instanceof Error?i.message:"Failed to get image info";throw a.value=g,new Error(g)}};return{isUploading:N(o),uploadProgress:N(b),error:N(a),compressionEnabled:U,uploadImage:F,uploadImages:V,deleteImage:t,getImageInfo:h}},we={class:"space-y-4"},ke={class:"flex items-center justify-between"},Ie={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Fe={class:"text-xs text-gray-500"},$e={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Ee=["src","alt"],Ae={class:"absolute inset-0 flex items-center justify-center"},Ce=["disabled"],Pe={class:"space-y-2"},Re={class:"text-sm text-gray-600 dark:text-gray-400"},Be={class:"font-medium"},qe={class:"text-xs mt-1"},De={key:2,class:"text-sm text-red-600 dark:text-red-400"},Me=X({__name:"ImageUpload",props:{modelValue:{},maxImages:{default:5},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(f,{emit:I}){const o=f,b=I,{uploadImage:a,deleteImage:U,isUploading:F,error:V}=Ue(),{t}=G(),h=$(),c=$(!1),i=ie(()=>o.modelValue.length<o.maxImages),g=async v=>{if(!v||v.length===0)return;const u=o.maxImages-o.modelValue.length,r=Array.from(v).slice(0,u);try{for(const p of r){const _=await a(p);b("update:modelValue",[...o.modelValue,_])}}catch(p){console.error("Failed to upload images:",p)}},y=v=>{const u=v.target;g(u.files),u&&(u.value="")},E=v=>{v.preventDefault(),c.value=!1,!o.disabled&&g(v.dataTransfer?.files||null)},P=v=>{v.preventDefault(),c.value=!0},q=()=>{c.value=!1},T=async v=>{const u=o.modelValue[v];if(u)try{await U(u);const r=[...o.modelValue];r.splice(v,1),b("update:modelValue",r)}catch(r){console.error("Failed to delete image:",r)}},S=()=>{o.disabled||!i.value||h.value?.click()};return(v,u)=>{const r=K,p=ce;return x(),k("div",we,[n("div",ke,[n("label",Ie,m(e(t)("admin.images")),1),n("span",Fe,m(f.modelValue.length)+" / "+m(f.maxImages),1)]),f.modelValue.length>0?(x(),k("div",$e,[(x(!0),k(L,null,W(f.modelValue,(_,D)=>(x(),k("div",{key:_,class:"relative group aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden"},[n("img",{src:e(_e)(_),alt:`Image ${D+1}`,class:"w-full h-full object-cover"},null,8,Ee),n("div",Ae,[l(r,{color:"error",variant:"solid",size:"sm",icon:"i-lucide-trash-2",disabled:f.disabled,onClick:R=>T(D)},{default:d(()=>[M(m(e(t)("common.delete")),1)]),_:1},8,["disabled","onClick"])])]))),128))])):O("",!0),e(i)?(x(),k("div",{key:1,class:Q(["border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center cursor-pointer transition-colors duration-200",{"border-primary-500 bg-primary-50 dark:bg-primary-900/20":e(c),"hover:border-gray-400 dark:hover:border-gray-500":!f.disabled&&!e(c),"opacity-50 cursor-not-allowed":f.disabled}]),onClick:S,onDrop:E,onDragover:P,onDragleave:q},[n("input",{ref_key:"fileInput",ref:h,type:"file",multiple:"",accept:"image/jpeg,image/png,image/webp",class:"hidden",disabled:f.disabled,onChange:y},null,40,Ce),n("div",Pe,[l(p,{name:"i-lucide-upload",class:Q(["mx-auto text-4xl text-gray-400",{"animate-pulse":e(F)}])},null,8,["class"]),n("div",Re,[n("p",Be,m(e(F)?e(t)("admin.uploading"):e(t)("admin.clickToUpload")),1),n("p",null,m(e(t)("admin.dragAndDrop")),1),n("p",qe,m(e(t)("admin.imageFormats"))+" ("+m(e(t)("admin.maxSize"))+": 5MB)",1)])])],34)):O("",!0),e(V)?(x(),k("div",De,m(e(V)),1)):O("",!0)])}}}),Oe=Object.assign(Me,{__name:"ImageUpload"}),Te={class:"text-base font-semibold"},Se={class:"space-y-4"},He={class:"flex items-center justify-between"},je={class:"text-base font-semibold"},Ne={class:"space-y-4"},ze={class:"space-y-2"},Le={class:"text-xs text-muted-foreground"},We={class:"space-y-3"},Ye={class:"text-base font-semibold"},Je={class:"flex items-center justify-between"},Qe={class:"text-base font-semibold"},Xe={class:"space-y-3"},Ge={class:"grid grid-cols-[1fr_1fr_40px] gap-2"},Ke={class:"text-sm font-medium"},Ze={class:"text-sm font-medium"},ea={class:"text-base font-semibold"},aa={class:"space-y-4"},ta={class:"text-xs text-muted-foreground"},oa={class:"text-xs text-muted-foreground"},ra={class:"space-y-3"},la={class:"text-xs text-muted-foreground"},sa={class:"flex items-center space-x-2"},na=X({__name:"ProductForm",props:{product:{},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(f,{emit:I}){const o=f,b=I,{t:a}=G(),{categories:U,fetchCategories:F}=ye(),V=j({name:j({en:C().min(1,a("admin.products.errors.nameEnRequired")),ru:C().min(1,a("admin.products.errors.nameRuRequired"))}),description:j({en:C().min(1,a("admin.products.errors.descriptionEnRequired")),ru:C().min(1,a("admin.products.errors.descriptionRuRequired"))}),categoryId:C().min(1,a("admin.products.errors.categoryRequired")),slug:C().min(1,a("admin.products.errors.slugRequired")),contactUsername:C().min(1,a("admin.products.errors.contactUsernameRequired")),sortOrder:oe().min(0),isActive:J(),isAvailable:J()}),t=ue({name:{en:o.product?.name.en||"",ru:o.product?.name.ru||""},description:{en:o.product?.description.en||"",ru:o.product?.description.ru||""},categoryId:o.product?.categoryId||"",slug:o.product?.slug||"",contactUsername:o.product?.contactUsername||"",sortOrder:o.product?.sortOrder||0,isActive:o.product?.isActive??!0,isAvailable:o.product?.isAvailable??!0}),h=$(o.product?.pricing&&o.product.pricing.length>0?o.product.pricing.map(u=>({...u})):[{period:"day",price:0,currency:"₽"}]),c=$(o.product?.images?[...o.product.images]:[]),i=$(o.product?.features&&(o.product.features.en.length>0||o.product.features.ru.length>0)?Array.from({length:Math.max(o.product.features.en.length,o.product.features.ru.length)},(u,r)=>({en:o.product.features.en[r]||"",ru:o.product.features.ru[r]||""})):[{en:"",ru:""}]),g=[{value:"hour",label:a("admin.products.priceUnits.hour")},{value:"day",label:a("admin.products.priceUnits.day")},{value:"week",label:a("admin.products.priceUnits.week")},{value:"month",label:a("admin.products.priceUnits.month")}],y=[{value:"₽",label:"₽ (RUB)"},{value:"$",label:"$ (USD)"},{value:"€",label:"€ (EUR)"},{value:"฿",label:"฿ (THB)"},{value:"¥",label:"¥ (CNY/JPY)"}],E=()=>{h.value.push({period:"day",price:0,currency:"₽"})},P=u=>{h.value.length>1&&h.value.splice(u,1)},q=()=>{i.value.push({en:"",ru:""})},T=u=>{i.value.length>1&&i.value.splice(u,1)},S=u=>u.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();me(()=>t.name.en,u=>{!o.product&&u&&(t.slug=S(u))}),pe(async()=>{U.value.length||await F()});const v=async()=>{const u=i.value.filter(p=>p.en.trim()||p.ru.trim()),r={name:t.name,description:t.description,categoryId:t.categoryId,pricing:h.value.filter(p=>p.price>0),images:c.value,slug:t.slug,features:{en:u.map(p=>p.en.trim()).filter(Boolean),ru:u.map(p=>p.ru.trim()).filter(Boolean)},sortOrder:t.sortOrder,isActive:t.isActive,isAvailable:t.isAvailable,contactUsername:t.contactUsername.trim()};b("submit",r)};return(u,r)=>{const p=ae,_=te,D=le,R=ne,B=K,H=fe,Z=Oe,Y=se,ee=re;return x(),z(ee,{schema:e(V),state:e(t),class:"space-y-4",onSubmit:v},{default:d(()=>[l(R,null,{header:d(()=>[n("h3",Te,m(e(a)("admin.products.form.basicInfo")),1)]),default:d(()=>[n("div",Se,[l(_,{label:e(a)("admin.products.form.nameEn"),name:"name.en",required:""},{default:d(()=>[l(p,{modelValue:e(t).name.en,"onUpdate:modelValue":r[0]||(r[0]=s=>e(t).name.en=s),placeholder:e(a)("admin.products.form.nameEnPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(_,{label:e(a)("admin.products.form.nameRu"),name:"name.ru",required:""},{default:d(()=>[l(p,{modelValue:e(t).name.ru,"onUpdate:modelValue":r[1]||(r[1]=s=>e(t).name.ru=s),placeholder:e(a)("admin.products.form.nameRuPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(_,{label:e(a)("admin.products.form.descriptionEn"),name:"description.en",required:""},{default:d(()=>[l(D,{modelValue:e(t).description.en,"onUpdate:modelValue":r[2]||(r[2]=s=>e(t).description.en=s),placeholder:e(a)("admin.products.form.descriptionEnPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(_,{label:e(a)("admin.products.form.descriptionRu"),name:"description.ru",required:""},{default:d(()=>[l(D,{modelValue:e(t).description.ru,"onUpdate:modelValue":r[3]||(r[3]=s=>e(t).description.ru=s),placeholder:e(a)("admin.products.form.descriptionRuPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])]),_:1}),l(R,null,{header:d(()=>[n("div",He,[n("h3",je,m(e(a)("admin.products.form.categoryAndPrice")),1),l(B,{icon:"i-lucide-plus",size:"xs",color:"primary",variant:"soft",onClick:E},{default:d(()=>[M(m(e(a)("admin.products.form.addPrice")),1)]),_:1})])]),default:d(()=>[n("div",Ne,[l(_,{label:e(a)("admin.products.form.category"),name:"categoryId",required:""},{default:d(()=>[l(H,{modelValue:e(t).categoryId,"onUpdate:modelValue":r[4]||(r[4]=s=>e(t).categoryId=s),items:e(U).map(s=>({value:s.$id,label:s.name[u.$i18n.locale]})),"value-key":"value",placeholder:e(a)("admin.products.form.categoryPlaceholder")},null,8,["modelValue","items","placeholder"])]),_:1},8,["label"]),n("div",ze,[n("p",Le,m(e(a)("admin.products.form.priceOptional")),1),n("div",We,[(x(!0),k(L,null,W(e(h),(s,A)=>(x(),k("div",{key:A,class:"flex items-end gap-2"},[l(_,{label:A===0?e(a)("admin.products.form.price"):"",class:"flex-1"},{default:d(()=>[l(p,{modelValue:s.price,"onUpdate:modelValue":w=>s.price=w,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),l(_,{label:A===0?e(a)("admin.products.form.currency"):"",class:"w-32"},{default:d(()=>[l(H,{"model-value":s.currency,items:y,"value-key":"value","onUpdate:modelValue":w=>s.currency=w},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),l(_,{label:A===0?e(a)("admin.products.form.priceUnit"):"",class:"w-32"},{default:d(()=>[l(H,{"model-value":s.period,items:g,"value-key":"value","onUpdate:modelValue":w=>s.period=w},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),e(h).length>1?(x(),z(B,{key:0,icon:"i-lucide-trash-2",color:"error",variant:"soft",size:"sm",onClick:w=>P(A)},null,8,["onClick"])):O("",!0)]))),128))])])])]),_:1}),l(R,null,{header:d(()=>[n("h3",Ye,m(e(a)("admin.products.images")),1)]),default:d(()=>[l(Z,{modelValue:e(c),"onUpdate:modelValue":r[5]||(r[5]=s=>ge(c)?c.value=s:null),"max-images":5},null,8,["modelValue"])]),_:1}),l(R,null,{header:d(()=>[n("div",Je,[n("h3",Qe,m(e(a)("admin.products.form.features")),1),l(B,{icon:"i-lucide-plus",size:"xs",color:"primary",variant:"soft",onClick:q},{default:d(()=>[M(m(e(a)("admin.products.form.addFeature")),1)]),_:1})])]),default:d(()=>[n("div",Xe,[n("div",Ge,[n("span",Ke,m(e(a)("admin.products.form.featuresEn")),1),n("span",Ze,m(e(a)("admin.products.form.featuresRu")),1),r[12]||(r[12]=n("span",null,null,-1))]),(x(!0),k(L,null,W(e(i),(s,A)=>(x(),k("div",{key:A,class:"grid grid-cols-[1fr_1fr_40px] gap-2 items-center"},[l(p,{modelValue:s.en,"onUpdate:modelValue":w=>s.en=w,placeholder:e(a)("admin.products.form.featureEnPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),l(p,{modelValue:s.ru,"onUpdate:modelValue":w=>s.ru=w,placeholder:e(a)("admin.products.form.featureRuPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),e(i).length>1?(x(),z(B,{key:0,icon:"i-lucide-trash-2",color:"error",variant:"ghost",size:"sm",onClick:w=>T(A)},null,8,["onClick"])):O("",!0)]))),128))])]),_:1}),l(R,null,{header:d(()=>[n("h3",ea,m(e(a)("admin.products.form.settings")),1)]),default:d(()=>[n("div",aa,[l(_,{label:e(a)("admin.products.form.slug"),name:"slug",required:""},{help:d(()=>[n("span",ta,m(e(a)("admin.products.form.slugHelp")),1)]),default:d(()=>[l(p,{modelValue:e(t).slug,"onUpdate:modelValue":r[6]||(r[6]=s=>e(t).slug=s),placeholder:e(a)("admin.products.form.slugPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(_,{label:e(a)("product.contact.username_label"),name:"contactUsername",required:""},{help:d(()=>[n("span",oa,m(e(a)("product.contact.username_help")),1)]),default:d(()=>[l(p,{modelValue:e(t).contactUsername,"onUpdate:modelValue":r[7]||(r[7]=s=>e(t).contactUsername=s),placeholder:e(a)("product.contact.username_placeholder"),icon:"i-lucide-at-sign"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(_,{label:e(a)("admin.products.form.sortOrder"),name:"sortOrder"},{default:d(()=>[l(p,{modelValue:e(t).sortOrder,"onUpdate:modelValue":r[8]||(r[8]=s=>e(t).sortOrder=s),modelModifiers:{number:!0},type:"number",min:"0"},null,8,["modelValue"])]),_:1},8,["label"]),n("div",ra,[l(_,{name:"isActive"},{default:d(()=>[l(Y,{modelValue:e(t).isActive,"onUpdate:modelValue":r[9]||(r[9]=s=>e(t).isActive=s),label:e(a)("admin.products.form.isActive")},null,8,["modelValue","label"])]),_:1}),l(_,{name:"isAvailable"},{help:d(()=>[n("span",la,m(e(a)("admin.products.form.isAvailableHelp")),1)]),default:d(()=>[l(Y,{modelValue:e(t).isAvailable,"onUpdate:modelValue":r[10]||(r[10]=s=>e(t).isAvailable=s),label:e(a)("admin.products.form.isAvailable")},null,8,["modelValue","label"])]),_:1})])])]),_:1}),n("div",sa,[l(B,{color:"neutral",variant:"ghost",block:"",onClick:r[11]||(r[11]=s=>b("cancel"))},{default:d(()=>[M(m(e(a)("common.cancel")),1)]),_:1}),l(B,{type:"submit",loading:f.loading,color:"primary",block:""},{default:d(()=>[M(m(f.product?e(a)("common.save"):e(a)("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["schema","state"])}}}),_a=Object.assign(na,{__name:"ProductForm"});export{_a as _};
