import{_ as oe}from"./B6CrvpT0.js";import{_ as le}from"./BRNMmTJi.js";import{o as L,n as re,s as B,_ as se,a as ne,b as de,c as G}from"./C_POXWz9.js";import{_ as ie}from"./Cy3FbJb-.js";import{r as $,L as N,R as ce,e as X,f as Z,g as ue,c as F,o as x,a as d,k as O,t as g,h as e,F as W,n as Y,b as l,w as n,d as M,m as ee,p as J,j as me,S as pe,H as ge,l as fe,i as z,D as K}from"./V5lyJHf0.js";import{_ as he}from"./BwyOfMx_.js";import{v as ve,g as _e}from"./BiCHA1TK.js";import{u as be,I as ye}from"./DKPM1GVg.js";import{u as xe}from"./DapeseBQ.js";const Ve={maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"},we=async(f,E={})=>{const t={...Ve,...E};return new Promise((b,a)=>{const w=new FileReader;w.onload=A=>{const V=new Image;V.onload=()=>{try{const o=document.createElement("canvas");let{width:v,height:i}=V;if(v>t.maxWidth||i>t.maxHeight){const u=Math.min(t.maxWidth/v,t.maxHeight/i);v=Math.round(v*u),i=Math.round(i*u)}o.width=v,o.height=i;const c=o.getContext("2d");if(!c){a(new Error("Failed to get canvas context"));return}c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.drawImage(V,0,0,v,i),o.toBlob(u=>{if(!u){a(new Error("Failed to compress image"));return}const y=new File([u],f.name,{type:t.mimeType,lastModified:Date.now()});b(y)},t.mimeType,t.quality)}catch(o){a(o)}},V.onerror=()=>{a(new Error("Failed to load image"))},V.src=A.target?.result},w.onerror=()=>{a(new Error("Failed to read file"))},w.readAsDataURL(f)})};const Ue=()=>{const{storage:f}=be(),E=ce(),t=$(!1),b=$(0),a=$(null),w=$(!0),A=async(i,c=!0)=>{const u=ve(i);if(!u.isValid)throw new Error(u.error);t.value=!0,a.value=null,b.value=0;try{let y=i;c&&w.value&&(b.value=10,y=await we(i,{maxWidth:1920,maxHeight:1920,quality:.85,mimeType:"image/webp"}),b.value=30);const C=ye.unique(),P=E.public.appwriteBucketId;if(!P)throw new Error("Storage bucket ID is not configured");const D=await f.createFile(P,C,y);return b.value=100,D.$id}catch(y){const C=y instanceof Error?y.message:"Failed to upload image";throw a.value=C,new Error(C)}finally{t.value=!1}},V=async(i,c=!0)=>{const u=i.map(y=>A(y,c));return Promise.all(u)},o=async i=>{try{const c=E.public.appwriteBucketId;if(!c)throw new Error("Storage bucket ID is not configured");await f.deleteFile(c,i)}catch(c){const u=c instanceof Error?c.message:"Failed to delete image";throw a.value=u,new Error(u)}},v=async i=>{try{const c=E.public.appwriteBucketId;if(!c)throw new Error("Storage bucket ID is not configured");return await f.getFile(c,i)}catch(c){const u=c instanceof Error?c.message:"Failed to get image info";throw a.value=u,new Error(u)}};return{isUploading:N(t),uploadProgress:N(b),error:N(a),compressionEnabled:w,uploadImage:A,uploadImages:V,deleteImage:o,getImageInfo:v}},ke={class:"space-y-4"},Ie={class:"flex items-center justify-between"},Fe={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},$e={class:"text-xs text-gray-500"},Ee={key:0,class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Ae=["src","alt"],Ce={class:"absolute inset-0 flex items-center justify-center"},Pe=["disabled"],Re={class:"space-y-2"},Be={class:"text-sm text-gray-600 dark:text-gray-400"},De={class:"font-medium"},qe={class:"text-xs mt-1"},Me={key:2,class:"text-sm text-red-600 dark:text-red-400"},Oe=X({__name:"ImageUpload",props:{modelValue:{},maxImages:{default:5},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(f,{emit:E}){const t=f,b=E,{uploadImage:a,deleteImage:w,isUploading:A,error:V}=Ue(),{t:o}=Z(),v=$(),i=$(!1),c=ue(()=>t.modelValue.length<t.maxImages),u=async _=>{if(!_||_.length===0)return;const U=t.maxImages-t.modelValue.length,m=Array.from(_).slice(0,U);try{for(const s of m){const p=await a(s);b("update:modelValue",[...t.modelValue,p])}}catch(s){console.error("Failed to upload images:",s)}},y=_=>{const U=_.target;u(U.files),U&&(U.value="")},C=_=>{_.preventDefault(),i.value=!1,!t.disabled&&u(_.dataTransfer?.files||null)},P=_=>{_.preventDefault(),i.value=!0},D=()=>{i.value=!1},S=async _=>{const U=t.modelValue[_];if(U)try{await w(U);const m=[...t.modelValue];m.splice(_,1),b("update:modelValue",m)}catch(m){console.error("Failed to delete image:",m)}},T=()=>{t.disabled||!c.value||v.value?.click()};return(_,U)=>{const m=ee,s=me;return x(),F("div",ke,[d("div",Ie,[d("label",Fe,g(e(o)("admin.images")),1),d("span",$e,g(f.modelValue.length)+" / "+g(f.maxImages),1)]),f.modelValue.length>0?(x(),F("div",Ee,[(x(!0),F(W,null,Y(f.modelValue,(p,h)=>(x(),F("div",{key:p,class:"relative group aspect-square bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden"},[d("img",{src:e(_e)(p),alt:`Image ${h+1}`,class:"w-full h-full object-cover"},null,8,Ae),d("div",Ce,[l(m,{color:"error",variant:"solid",size:"sm",icon:"i-lucide-trash-2",disabled:f.disabled,onClick:H=>S(h)},{default:n(()=>[M(g(e(o)("common.delete")),1)]),_:1},8,["disabled","onClick"])])]))),128))])):O("",!0),e(c)?(x(),F("div",{key:1,class:J(["border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center cursor-pointer transition-colors duration-200",{"border-primary-500 bg-primary-50 dark:bg-primary-900/20":e(i),"hover:border-gray-400 dark:hover:border-gray-500":!f.disabled&&!e(i),"opacity-50 cursor-not-allowed":f.disabled}]),onClick:T,onDrop:C,onDragover:P,onDragleave:D},[d("input",{ref_key:"fileInput",ref:v,type:"file",multiple:"",accept:"image/jpeg,image/png,image/webp",class:"hidden",disabled:f.disabled,onChange:y},null,40,Pe),d("div",Re,[l(s,{name:"i-lucide-upload",class:J(["mx-auto text-4xl text-gray-400",{"animate-pulse":e(A)}])},null,8,["class"]),d("div",Be,[d("p",De,g(e(A)?e(o)("admin.uploading"):e(o)("admin.clickToUpload")),1),d("p",null,g(e(o)("admin.dragAndDrop")),1),d("p",qe,g(e(o)("admin.imageFormats"))+" ("+g(e(o)("admin.maxSize"))+": 5MB)",1)])])],34)):O("",!0),e(V)?(x(),F("div",Me,g(e(V)),1)):O("",!0)])}}}),Se=Object.assign(Oe,{__name:"ImageUpload"}),Te={class:"text-base font-semibold"},He={class:"space-y-4"},je={class:"flex items-center justify-between"},Le={class:"text-base font-semibold"},Ne={class:"space-y-4"},ze={class:"space-y-2"},We={class:"text-xs text-muted-foreground"},Ye={class:"space-y-3"},Je={class:"text-base font-semibold"},Qe={class:"flex items-center justify-between"},Ge={class:"text-base font-semibold"},Ke={class:"space-y-4"},Xe={class:"flex items-start gap-2"},Ze={class:"flex-1 space-y-2"},ea={class:"text-base font-semibold"},aa={class:"space-y-4"},ta={class:"text-xs text-muted-foreground"},oa={class:"text-xs text-muted-foreground"},la={class:"space-y-3"},ra={class:"text-xs text-muted-foreground"},sa={class:"flex items-center space-x-2"},na=X({__name:"ProductForm",props:{product:{},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(f,{emit:E}){const t=f,b=E,{t:a}=Z(),{categories:w,fetchCategories:A}=xe(),V=L({name:L({en:B().min(1,a("admin.products.errors.nameEnRequired")),ru:B().min(1,a("admin.products.errors.nameRuRequired"))}),description:L({en:B().min(1,a("admin.products.errors.descriptionEnRequired")),ru:B().min(1,a("admin.products.errors.descriptionRuRequired"))}),categoryId:B().min(1,a("admin.products.errors.categoryRequired")),slug:B().min(1,a("admin.products.errors.slugRequired")),sortOrder:re().min(0),isActive:G(),isAvailable:G()}),o=pe({name:{en:t.product?.name.en||"",ru:t.product?.name.ru||""},description:{en:t.product?.description.en||"",ru:t.product?.description.ru||""},categoryId:t.product?.categoryId||"",slug:t.product?.slug||"",sortOrder:t.product?.sortOrder||0,isActive:t.product?.isActive??!0,isAvailable:t.product?.isAvailable??!0}),v=$(t.product?.contactUsername||""),i=$(t.product?.pricing&&t.product.pricing.length>0?t.product.pricing.map(m=>({...m})):[{period:"day",price:0,currency:"₽"}]),c=$(t.product?.images?[...t.product.images]:[]),u=$(t.product?.features&&(t.product.features.en.length>0||t.product.features.ru.length>0)?Array.from({length:Math.max(t.product.features.en.length,t.product.features.ru.length)},(m,s)=>({en:t.product.features.en[s]||"",ru:t.product.features.ru[s]||""})):[{en:"",ru:""}]),y=[{value:"hour",label:a("admin.products.priceUnits.hour")},{value:"day",label:a("admin.products.priceUnits.day")},{value:"week",label:a("admin.products.priceUnits.week")},{value:"month",label:a("admin.products.priceUnits.month")}],C=[{value:"₽",label:"₽ (RUB)"},{value:"$",label:"$ (USD)"},{value:"€",label:"€ (EUR)"},{value:"฿",label:"฿ (THB)"},{value:"¥",label:"¥ (CNY/JPY)"}],P=()=>{i.value.push({period:"day",price:0,currency:"₽"})},D=m=>{i.value.length>1&&i.value.splice(m,1)},S=()=>{u.value.push({en:"",ru:""})},T=m=>{u.value.length>1&&u.value.splice(m,1)},_=m=>m.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim();ge(()=>o.name.en,m=>{!t.product&&m&&(o.slug=_(m))}),fe(async()=>{w.value.length||await A()});const U=async()=>{const m=u.value.filter(p=>p.en.trim()||p.ru.trim()),s={name:o.name,description:o.description,categoryId:o.categoryId,pricing:i.value.filter(p=>p.price>0),images:c.value,slug:o.slug,features:{en:m.map(p=>p.en.trim()).filter(Boolean),ru:m.map(p=>p.ru.trim()).filter(Boolean)},sortOrder:o.sortOrder,isActive:o.isActive,isAvailable:o.isAvailable,contactUsername:v.value.trim()||void 0};b("submit",s)};return(m,s)=>{const p=oe,h=le,H=ne,q=ie,R=ee,j=he,ae=Se,Q=de,te=se;return x(),z(te,{schema:e(V),state:e(o),class:"space-y-4",onSubmit:U},{default:n(()=>[l(q,null,{header:n(()=>[d("h3",Te,g(e(a)("admin.products.form.basicInfo")),1)]),default:n(()=>[d("div",He,[l(h,{label:e(a)("admin.products.form.nameEn"),name:"name.en",required:""},{default:n(()=>[l(p,{modelValue:e(o).name.en,"onUpdate:modelValue":s[0]||(s[0]=r=>e(o).name.en=r),placeholder:e(a)("admin.products.form.nameEnPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(h,{label:e(a)("admin.products.form.nameRu"),name:"name.ru",required:""},{default:n(()=>[l(p,{modelValue:e(o).name.ru,"onUpdate:modelValue":s[1]||(s[1]=r=>e(o).name.ru=r),placeholder:e(a)("admin.products.form.nameRuPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(h,{label:e(a)("admin.products.form.descriptionEn"),name:"description.en",required:""},{default:n(()=>[l(H,{modelValue:e(o).description.en,"onUpdate:modelValue":s[2]||(s[2]=r=>e(o).description.en=r),placeholder:e(a)("admin.products.form.descriptionEnPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(h,{label:e(a)("admin.products.form.descriptionRu"),name:"description.ru",required:""},{default:n(()=>[l(H,{modelValue:e(o).description.ru,"onUpdate:modelValue":s[3]||(s[3]=r=>e(o).description.ru=r),placeholder:e(a)("admin.products.form.descriptionRuPlaceholder"),rows:4},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])]),_:1}),l(q,null,{header:n(()=>[d("div",je,[d("h3",Le,g(e(a)("admin.products.form.categoryAndPrice")),1),l(R,{icon:"i-lucide-plus",size:"xs",color:"primary",variant:"soft",onClick:P},{default:n(()=>[M(g(e(a)("admin.products.form.addPrice")),1)]),_:1})])]),default:n(()=>[d("div",Ne,[l(h,{label:e(a)("admin.products.form.category"),name:"categoryId",required:""},{default:n(()=>[l(j,{modelValue:e(o).categoryId,"onUpdate:modelValue":s[4]||(s[4]=r=>e(o).categoryId=r),items:e(w).map(r=>({value:r.$id,label:r.name[m.$i18n.locale]})),"value-key":"value",placeholder:e(a)("admin.products.form.categoryPlaceholder")},null,8,["modelValue","items","placeholder"])]),_:1},8,["label"]),d("div",ze,[d("p",We,g(e(a)("admin.products.form.priceOptional")),1),d("div",Ye,[(x(!0),F(W,null,Y(e(i),(r,k)=>(x(),F("div",{key:k,class:"flex items-end gap-2"},[l(h,{label:k===0?e(a)("admin.products.form.price"):"",class:"flex-1"},{default:n(()=>[l(p,{modelValue:r.price,"onUpdate:modelValue":I=>r.price=I,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),l(h,{label:k===0?e(a)("admin.products.form.currency"):"",class:"w-32"},{default:n(()=>[l(j,{"model-value":r.currency,items:C,"value-key":"value","onUpdate:modelValue":I=>r.currency=I},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),l(h,{label:k===0?e(a)("admin.products.form.priceUnit"):"",class:"w-32"},{default:n(()=>[l(j,{"model-value":r.period,items:y,"value-key":"value","onUpdate:modelValue":I=>r.period=I},null,8,["model-value","onUpdate:modelValue"])]),_:2},1032,["label"]),e(i).length>1?(x(),z(R,{key:0,icon:"i-lucide-trash-2",color:"error",variant:"soft",size:"sm",onClick:I=>D(k)},null,8,["onClick"])):O("",!0)]))),128))])])])]),_:1}),l(q,null,{header:n(()=>[d("h3",Je,g(e(a)("admin.products.images")),1)]),default:n(()=>[l(ae,{modelValue:e(c),"onUpdate:modelValue":s[5]||(s[5]=r=>K(c)?c.value=r:null),"max-images":5},null,8,["modelValue"])]),_:1}),l(q,null,{header:n(()=>[d("div",Qe,[d("h3",Ge,g(e(a)("admin.products.form.features")),1),l(R,{icon:"i-lucide-plus",size:"xs",color:"primary",variant:"soft",onClick:S},{default:n(()=>[M(g(e(a)("admin.products.form.addFeature")),1)]),_:1})])]),default:n(()=>[d("div",Ke,[(x(!0),F(W,null,Y(e(u),(r,k)=>(x(),F("div",{key:k,class:"space-y-2"},[d("div",Xe,[d("div",Ze,[l(h,{label:k===0?e(a)("admin.products.form.featuresEn"):""},{default:n(()=>[l(p,{modelValue:r.en,"onUpdate:modelValue":I=>r.en=I,placeholder:e(a)("admin.products.form.featureEnPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]),l(h,{label:k===0?e(a)("admin.products.form.featuresRu"):""},{default:n(()=>[l(p,{modelValue:r.ru,"onUpdate:modelValue":I=>r.ru=I,placeholder:e(a)("admin.products.form.featureRuPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])]),e(u).length>1?(x(),z(R,{key:0,icon:"i-lucide-trash-2",color:"error",variant:"soft",size:"sm",class:J({"mt-6":k===0}),onClick:I=>T(k)},null,8,["class","onClick"])):O("",!0)])]))),128))])]),_:1}),l(q,null,{header:n(()=>[d("h3",ea,g(e(a)("admin.products.form.settings")),1)]),default:n(()=>[d("div",aa,[l(h,{label:e(a)("admin.products.form.slug"),name:"slug",required:""},{help:n(()=>[d("span",ta,g(e(a)("admin.products.form.slugHelp")),1)]),default:n(()=>[l(p,{modelValue:e(o).slug,"onUpdate:modelValue":s[6]||(s[6]=r=>e(o).slug=r),placeholder:e(a)("admin.products.form.slugPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(h,{label:e(a)("product.contact.username_label")},{help:n(()=>[d("span",oa,g(e(a)("product.contact.username_help")),1)]),default:n(()=>[l(p,{modelValue:e(v),"onUpdate:modelValue":s[7]||(s[7]=r=>K(v)?v.value=r:null),placeholder:e(a)("product.contact.username_placeholder"),icon:"i-lucide-at-sign"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(h,{label:e(a)("admin.products.form.sortOrder"),name:"sortOrder"},{default:n(()=>[l(p,{modelValue:e(o).sortOrder,"onUpdate:modelValue":s[8]||(s[8]=r=>e(o).sortOrder=r),modelModifiers:{number:!0},type:"number",min:"0"},null,8,["modelValue"])]),_:1},8,["label"]),d("div",la,[l(h,{name:"isActive"},{default:n(()=>[l(Q,{modelValue:e(o).isActive,"onUpdate:modelValue":s[9]||(s[9]=r=>e(o).isActive=r),label:e(a)("admin.products.form.isActive")},null,8,["modelValue","label"])]),_:1}),l(h,{name:"isAvailable"},{help:n(()=>[d("span",ra,g(e(a)("admin.products.form.isAvailableHelp")),1)]),default:n(()=>[l(Q,{modelValue:e(o).isAvailable,"onUpdate:modelValue":s[10]||(s[10]=r=>e(o).isAvailable=r),label:e(a)("admin.products.form.isAvailable")},null,8,["modelValue","label"])]),_:1})])])]),_:1}),d("div",sa,[l(R,{color:"neutral",variant:"ghost",block:"",onClick:s[11]||(s[11]=r=>b("cancel"))},{default:n(()=>[M(g(e(a)("common.cancel")),1)]),_:1}),l(R,{type:"submit",loading:f.loading,color:"primary",block:""},{default:n(()=>[M(g(f.product?e(a)("common.save"):e(a)("common.add")),1)]),_:1},8,["loading"])])]),_:1},8,["schema","state"])}}}),va=Object.assign(na,{__name:"ProductForm"});export{va as _};
