import{u as C,I as q,Q as m}from"./BkcUQ56Y.js";import{u as F}from"./Bg3rBmSY.js";import{r as f,S as $,M as p}from"./CGidw6B-.js";const g=t=>({...t,name:typeof t.name=="string"?JSON.parse(t.name):t.name,description:typeof t.description=="string"?JSON.parse(t.description):t.description,features:typeof t.features=="string"?JSON.parse(t.features):t.features,contactMessage:typeof t.contactMessage=="string"?JSON.parse(t.contactMessage):t.contactMessage,pricing:typeof t.pricing=="string"?JSON.parse(t.pricing):t.pricing||[]}),u=f([]),s=f(!1),o=f(null),N=f(0),x=300*1e3,k=()=>{const t=f(null),{databases:a}=C(),{handleError:v,handleSuccess:d}=F(),h=$(),i=h.public.appwriteBdKey,c=h.public.appwriteCollectionProducts,O=()=>Date.now()-N.value<x&&u.value.length>0,S=async(r,e=!1)=>{if(!e&&!r&&O())return u.value;s.value=!0,o.value=null;try{const n=[m.equal("isActive",!0),m.orderDesc("$createdAt")];r&&n.push(m.equal("categoryId",r));const l=(await a.listDocuments(i,c,n)).documents.map(g);return r||(u.value=l,N.value=Date.now()),l}catch(n){throw o.value=n instanceof Error?n.message:"Unknown error",n}finally{s.value=!1}},w=async r=>{s.value=!0,o.value=null;try{const e=await a.getDocument(i,c,r);return t.value=g(e),t.value}catch(e){throw o.value=e instanceof Error?e.message:"Unknown error",e}finally{s.value=!1}},J=async()=>S(void 0,!0),P=async r=>{s.value=!0,o.value=null;try{const e=await a.createDocument(i,c,q.unique(),{...r,name:JSON.stringify(r.name),description:JSON.stringify(r.description),features:JSON.stringify(r.features||[]),contactMessage:JSON.stringify(r.contactMessage||{}),pricing:JSON.stringify(r.pricing||[]),isActive:r.isActive??!0}),n=g(e);return u.value.unshift(n),d("Товар успешно создан"),n}catch(e){return console.error("Error creating product:",e),o.value="Failed to create product",v(e,"Ошибка создания товара"),null}finally{s.value=!1}},D=async(r,e)=>{s.value=!0,o.value=null;try{const n=await a.updateDocument(i,c,r,{...e,name:e.name?JSON.stringify(e.name):void 0,description:e.description?JSON.stringify(e.description):void 0,features:e.features?JSON.stringify(e.features):void 0,contactMessage:e.contactMessage?JSON.stringify(e.contactMessage):void 0,pricing:e.pricing?JSON.stringify(e.pricing):void 0}),y=g(n),l=u.value.findIndex(b=>b.$id===r);return l!==-1&&(u.value[l]=y),d("Товар успешно обновлен"),y}catch(n){return console.error("Error updating product:",n),o.value="Failed to update product",v(n,"Ошибка обновления товара"),null}finally{s.value=!1}},M=async r=>{s.value=!0,o.value=null;try{return await a.deleteDocument(i,c,r),u.value=u.value.filter(e=>e.$id!==r),d("Товар успешно удален"),!0}catch(e){return console.error("Error deleting product:",e),o.value="Failed to delete product",v(e,"Ошибка удаления товара"),!1}finally{s.value=!1}},E=r=>u.value.find(e=>e.slug===r),A=r=>u.value.find(e=>e.$id===r);return{products:p(u),product:p(t),isLoading:p(s),loading:p(s),error:p(o),fetchProducts:S,fetchProduct:w,fetchAllProducts:J,createProduct:P,updateProduct:D,deleteProduct:M,getProductBySlug:E,getProductById:A}};export{k as u};
